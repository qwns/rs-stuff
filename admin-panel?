-- r's admin panel (View + Teleport + Selected ESP)

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local LP = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- constants
local BLUE = Color3.fromRGB(39,142,245)
local FONT = Enum.Font.GothamSemibold

-- cleanup
pcall(function()
    CoreGui:FindFirstChild("RsPanel"):Destroy()
end)

-- state
local selectedPlayer = nil
local viewingPlayer = nil
local espEnabled = false
local espHighlight = nil

-- gui
local gui = Instance.new("ScreenGui", CoreGui)
gui.Name = "RsPanel"
gui.ResetOnSpawn = false

local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0,260,0,190)
main.Position = UDim2.new(0.05,0,0.3,0)
main.BackgroundColor3 = Color3.fromRGB(15,15,15)
main.Active = true
main.Draggable = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0,16)

local canvas = Instance.new("CanvasGroup", main)

-- title
local title = Instance.new("TextLabel", main)
title.Size = UDim2.new(1,0,0,28)
title.Position = UDim2.new(0,0,0,6)
title.Text = "r's admin panel"
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.TextColor3 = BLUE
title.BackgroundTransparency = 1
title.TextXAlignment = Enum.TextXAlignment.Center

-- search box
local search = Instance.new("TextBox", main)
search.Position = UDim2.new(0,12,0,40)
search.Size = UDim2.new(1,-24,0,28)
search.PlaceholderText = "Search"
search.Font = FONT
search.TextSize = 14
search.TextColor3 = BLUE
search.PlaceholderColor3 = Color3.fromRGB(120,120,120)
search.BackgroundColor3 = Color3.fromRGB(30,30,30)
search.BorderSizePixel = 0
Instance.new("UICorner", search)

-- selected label
local selectedLabel = Instance.new("TextLabel", main)
selectedLabel.Position = UDim2.new(0,12,0,74)
selectedLabel.Size = UDim2.new(1,-24,0,18)
selectedLabel.Text = "Selected: None"
selectedLabel.Font = FONT
selectedLabel.TextSize = 13
selectedLabel.TextColor3 = BLUE
selectedLabel.BackgroundTransparency = 1
selectedLabel.TextXAlignment = Enum.TextXAlignment.Left

-- buttons container
local btnFrame = Instance.new("Frame", main)
btnFrame.Position = UDim2.new(0,12,0,96)
btnFrame.Size = UDim2.new(1,-24,0,80)
btnFrame.BackgroundTransparency = 1

-- top row
local topRow = Instance.new("Frame", btnFrame)
topRow.Size = UDim2.new(1,0,0,32)
topRow.BackgroundTransparency = 1

local topLayout = Instance.new("UIListLayout", topRow)
topLayout.FillDirection = Enum.FillDirection.Horizontal
topLayout.Padding = UDim.new(0,8)

-- bottom row
local bottomRow = Instance.new("Frame", btnFrame)
bottomRow.Position = UDim2.new(0,0,0,44)
bottomRow.Size = UDim2.new(1,0,0,32)
bottomRow.BackgroundTransparency = 1

-- button creator
local function makeButton(parent, text, widthScale)
    local b = Instance.new("TextButton", parent)
    b.Size = UDim2.new(widthScale,0,1,0)
    b.Text = text
    b.Font = FONT
    b.TextSize = 14
    b.TextColor3 = BLUE
    b.BackgroundColor3 = Color3.fromRGB(35,35,35)
    b.BorderSizePixel = 0
    Instance.new("UICorner", b)
    return b
end

-- buttons
local viewBtn = makeButton(topRow, "View", 0.5)
local tpBtn = makeButton(topRow, "Teleport", 0.5)
local espBtn = makeButton(bottomRow, "ESP: OFF", 1)

-- ESP helpers
local function clearESP()
    if espHighlight then
        espHighlight:Destroy()
        espHighlight = nil
    end
end

local function applyESP()
    clearESP()
    if not espEnabled or not selectedPlayer then return end
    if not selectedPlayer.Character then return end

    espHighlight = Instance.new("Highlight")
    espHighlight.FillTransparency = 1
    espHighlight.OutlineTransparency = 0
    espHighlight.OutlineColor = BLUE
    espHighlight.Parent = selectedPlayer.Character
end

-- player search
local function findPlayer(name)
    name = name:lower()
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LP and plr.Name:lower():sub(1, #name) == name then
            return plr
        end
    end
end

search:GetPropertyChangedSignal("Text"):Connect(function()
    local plr = findPlayer(search.Text)
    selectedPlayer = plr
    selectedLabel.Text = plr and ("Selected: " .. plr.Name) or "Selected: None"
    applyESP()
end)

-- view toggle
viewBtn.MouseButton1Click:Connect(function()
    if not selectedPlayer then return end

    if viewingPlayer == selectedPlayer then
        viewingPlayer = nil
        viewBtn.Text = "View"
        Camera.CameraSubject = LP.Character:FindFirstChildOfClass("Humanoid")
    else
        viewingPlayer = selectedPlayer
        viewBtn.Text = "Viewing"
        Camera.CameraSubject = selectedPlayer.Character:FindFirstChildOfClass("Humanoid")
    end

    Camera.CameraType = Enum.CameraType.Custom
end)

-- teleport
tpBtn.MouseButton1Click:Connect(function()
    if not selectedPlayer then return end

    viewingPlayer = nil
    viewBtn.Text = "View"
    Camera.CameraSubject = LP.Character:FindFirstChildOfClass("Humanoid")

    local hrp = LP.Character and LP.Character:FindFirstChild("HumanoidRootPart")
    local thrp = selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart")

    if hrp and thrp then
        hrp.CFrame = thrp.CFrame * CFrame.new(0,5,0)
    end
end)

-- ESP toggle
espBtn.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    espBtn.Text = espEnabled and "ESP: ON" or "ESP: OFF"
    applyESP()
end)

-- UI toggle
local uiOpen = true
UserInputService.InputBegan:Connect(function(i,gp)
    if gp then return end
    if i.KeyCode == Enum.KeyCode.RightControl then
        uiOpen = not uiOpen
        main.Visible = true
        TweenService:Create(canvas, TweenInfo.new(0.2), {
            GroupTransparency = uiOpen and 0 or 1
        }):Play()
        task.delay(0.2, function()
            if not uiOpen then main.Visible = false end
        end)
    end
end)
