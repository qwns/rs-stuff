
-- r's admin panel (Player View + Teleport)

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local LP = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- constants
local BLUE = Color3.fromRGB(39,142,245)
local FONT = Enum.Font.GothamSemibold

-- cleanup
pcall(function()
    CoreGui:FindFirstChild("RsPanel"):Destroy()
end)

-- state
local selectedPlayer = nil
local viewingPlayer = nil

-- gui
local gui = Instance.new("ScreenGui", CoreGui)
gui.Name = "RsPanel"
gui.ResetOnSpawn = false

local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0,260,0,160)
main.Position = UDim2.new(0.05,0,0.3,0)
main.BackgroundColor3 = Color3.fromRGB(15,15,15)
main.Active = true
main.Draggable = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0,16)

local canvas = Instance.new("CanvasGroup", main)

-- title
local title = Instance.new("TextLabel", main)
title.Size = UDim2.new(1,0,0,28)
title.Position = UDim2.new(0,0,0,6)
title.Text = "r's admin panel"
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.TextColor3 = BLUE
title.BackgroundTransparency = 1
title.TextXAlignment = Enum.TextXAlignment.Center

-- search box
local search = Instance.new("TextBox", main)
search.Position = UDim2.new(0,12,0,40)
search.Size = UDim2.new(1,-24,0,28)
search.PlaceholderText = "Search"
search.Text = ""
search.Font = FONT
search.TextSize = 14
search.TextColor3 = BLUE
search.PlaceholderColor3 = Color3.fromRGB(120,120,120)
search.BackgroundColor3 = Color3.fromRGB(30,30,30)
search.BorderSizePixel = 0
Instance.new("UICorner", search)

-- selected label
local selectedLabel = Instance.new("TextLabel", main)
selectedLabel.Position = UDim2.new(0,12,0,74)
selectedLabel.Size = UDim2.new(1,-24,0,18)
selectedLabel.Text = "Selected: None"
selectedLabel.Font = FONT
selectedLabel.TextSize = 13
selectedLabel.TextColor3 = BLUE
selectedLabel.BackgroundTransparency = 1
selectedLabel.TextXAlignment = Enum.TextXAlignment.Left

-- buttons frame
local btnFrame = Instance.new("Frame", main)
btnFrame.Position = UDim2.new(0,12,0,96)
btnFrame.Size = UDim2.new(1,-24,0,36)
btnFrame.BackgroundTransparency = 1

local layout = Instance.new("UIListLayout", btnFrame)
layout.FillDirection = Enum.FillDirection.Horizontal
layout.Padding = UDim.new(0,8)

-- view button
local viewBtn = Instance.new("TextButton", btnFrame)
viewBtn.Size = UDim2.new(0.5,-4,1,0)
viewBtn.Text = "View"
viewBtn.Font = FONT
viewBtn.TextSize = 14
viewBtn.TextColor3 = BLUE
viewBtn.BackgroundColor3 = Color3.fromRGB(35,35,35)
viewBtn.BorderSizePixel = 0
Instance.new("UICorner", viewBtn)

-- teleport button
local tpBtn = Instance.new("TextButton", btnFrame)
tpBtn.Size = UDim2.new(0.5,-4,1,0)
tpBtn.Text = "Teleport"
tpBtn.Font = FONT
tpBtn.TextSize = 14
tpBtn.TextColor3 = BLUE
tpBtn.BackgroundColor3 = Color3.fromRGB(35,35,35)
tpBtn.BorderSizePixel = 0
Instance.new("UICorner", tpBtn)

-- player selection
local function findPlayer(name)
    name = name:lower()
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr.Name:lower():sub(1, #name) == name then
            return plr
        end
    end
end

search:GetPropertyChangedSignal("Text"):Connect(function()
    local text = search.Text
    local plr = findPlayer(text)

    if plr and plr ~= LP then
        selectedPlayer = plr
        selectedLabel.Text = "Selected: " .. plr.Name
    else
        selectedPlayer = nil
        selectedLabel.Text = "Selected: None"
    end
end)

-- view toggle
viewBtn.MouseButton1Click:Connect(function()
    if not selectedPlayer then return end

    if viewingPlayer == selectedPlayer then
        -- stop viewing
        viewingPlayer = nil
        viewBtn.Text = "View"

        if LP.Character then
            local hum = LP.Character:FindFirstChildOfClass("Humanoid")
            if hum then
                Camera.CameraSubject = hum
                Camera.CameraType = Enum.CameraType.Custom
            end
        end
    else
        -- start viewing
        viewingPlayer = selectedPlayer
        viewBtn.Text = "Viewing"

        if selectedPlayer.Character then
            local hum = selectedPlayer.Character:FindFirstChildOfClass("Humanoid")
            if hum then
                Camera.CameraSubject = hum
                Camera.CameraType = Enum.CameraType.Custom
            end
        end
    end
end)

-- teleport on top
tpBtn.MouseButton1Click:Connect(function()
    if not selectedPlayer then return end

    -- stop viewing if active
    viewingPlayer = nil
    viewBtn.Text = "View"

    if LP.Character then
        local hum = LP.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            Camera.CameraSubject = hum
            Camera.CameraType = Enum.CameraType.Custom
        end
    end

    if LP.Character and selectedPlayer.Character then
        local hrp = LP.Character:FindFirstChild("HumanoidRootPart")
        local thrp = selectedPlayer.Character:FindFirstChild("HumanoidRootPart")

        if hrp and thrp then
            hrp.CFrame = thrp.CFrame * CFrame.new(0, 5, 0)
        end
    end
end)

-- UI toggle
local uiOpen = true
UserInputService.InputBegan:Connect(function(i, gp)
    if gp then return end
    if i.KeyCode == Enum.KeyCode.RightControl then
        uiOpen = not uiOpen
        main.Visible = true
        TweenService:Create(canvas, TweenInfo.new(0.2), {
            GroupTransparency = uiOpen and 0 or 1
        }):Play()
        task.delay(0.2, function()
            if not uiOpen then main.Visible = false end
        end)
    end
end)
